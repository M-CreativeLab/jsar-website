# 空间小程序

本节将介绍空间小程序以及与其相关的基本概念。

## 空间

在增强现实（AR）的场景中，空间是指现实世界中的一个区域，这个区域可以是一个平面，也可以是一个立体的物体。用户通过空间小程序来获取空间的信息，比如空间的大小、空间的位置、空间的旋转角度等等，而在一般的 AR 应用开发中，我们都会使用一个场景来承载空间。

![](intro-subspace-in-deskstop.png)

比如在 YodaOS-Master 系统中，系统桌面（如上图）就是一个空间，在这个空间中用户可以看到一系列环绕在空间中的虚拟屏幕，同时也可以看到对应的一些独立的物体，这些都是桌面空间中的实体。

## 空间自由度

在增强现实和虚拟现实领域，一般都会使用自由度（DoF）来描述空间的真实程度，自由度越高，空间越真实。

通常意义上，物体在空间中可以通过位置（Position）、姿态（Rotation）来定量表述其位姿（Pose）。那么在表述物体在空间中移动时，就可以将物体的移动分解为：位移、姿态。那么在 XYZ 坐标系下，位移可以表示为 X 轴偏量、Y 轴偏量、Z 轴偏量，旋转可以表征为 X 轴旋转角度（俯仰角）、Y轴旋转角度（偏航角）、Z轴旋转角度（翻滚角）。那么对于空间中的物体，若其在空间中自由移动，就会产生移动带来的 XYZ 轴3个轴向上的变化和姿态变化带来的角度变化，这种用于表述物体在空间中的位姿变化的自由度就表述为 DoF。

### 0Dof

0DoF（Zero Degree of Freedom）指的是当前空间中的观察者以固定视角观察虚拟空间。

![](space-0dof.gif)

### 3Dof

3DoF（Three Degree of Freedom）指的是当前空间中观察者可使用3 个自由度，通常情况下，这3 个自由度指的是空间的姿态。

> 现实的空间中，产生位姿变化的是运动的物体和观察者自身。
>
> 在虚拟空间中，通过摄像机（Camera）作为观察者记录空间中的物体变化。

在虚拟空间中，若摄像机（Camera）仅做姿态变化，就可表示当前空间具有3自由度 —— 即 3DoF，这意味着虚拟空间中物体按照程序控制实现其自身位于空间中的变化，而观察者的位置始终位于空间原点，并通过不同的姿态（Rotation）观察这个虚拟空间。

![](space-3dof.gif)

### 6Dof

6DoF（Six Degree of Freedom）指的是当前空间中观察者可以使用6个自由度，即位置（Position）和姿态（Rotation）加在一起共计6个。

当虚拟空间中的摄像机（Camera）可以产生位置（Position）和姿态（Rotation）的变化，就可表示当前空间具有6自由度 —— 即 6DoF。观察者（摄像机）可以在空间中以任意位姿（Pose）观察这个虚拟空间。

![](space-6dof.gif)

## 可嵌入空间

上面提到了空间，那么什么是可嵌入空间呢？

可嵌入空间，或称为子空间，指的是一个完整的空间，它包含了一些物体，然后可以将这个空间嵌入到另一个空间中，作为另一个空间的一个组件。这样，我们可以：

- 在父空间内，随意地对子空间进行移动、旋转、缩放
- 在父空间内，可以直接与子空间的物体进行交互
- 在父空间内，可以将多个子空间组合在一起，形成更复杂的空间

而可嵌入空间的技术关键点在于，如何将一个空间（独立的应用）嵌入到另一个空间（主应用）中，而不影响到主应用的运行，我们将这称为空间安全性，更形象的比较就像：

1. 在一个浏览器中，不同的网页运行在同一个 Web 浏览器中互不干扰，这就是浏览器的安全性。
2. 在一个窗口操作程序中，不同的窗口运行在同一个屏幕上，窗口和窗口之间互不干扰，这就是窗口操作程序的安全性。

以上，这就是可嵌入空间的基础概念。

## 空间小程序

在了解了空间和可嵌入空间后，那么就很容易了解什么是空间小程序了，它就是用于开发可嵌入空间的技术方案，在本页顶部的图片中，蓝色小方块的部分就是空间小程序（即 JSAR）希望去嵌入到主空间中的部分，它可以是一个闹钟、一个日历、一本漫画书、一个小黄鸭等等。
